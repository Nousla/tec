<!doctype html>
<html>
    <head>
        <title>JavaScript + WebSocket + Node.js chat</title>
        <link rel="stylesheet" type="text/css" href="chatroomstylesheet.css">
    </head>
    <body>
        <div id="container">
            <div class="logo">
                <p id="logo">JavaScript + WebSocket + Node.js Chat</p>
            </div>
            <div class="content">
                <div>
                    <div id="featureBox">
                        <div id="userListBox">
                            userlist
                        </div>
                        <div id="adminPriviliges">
                            <div class="buttonTest"><p>Make client a moderator</p></div>
                            <div class="buttonTest"><p>Mute/unmute client</p></div>
                            <div class="buttonTest"><p>Kick client</p></div>
                            <div class="buttonTest"><p>Ban client</p></div>
                        </div>
                    </div>
                    <div id="chatBox">
                        <div id="messages"></div>
                        <div id="sendMessage">
                            <div id="button_sendMessage" onclick="sendMessage()"><p>Send</p></div>
                            <textarea id="textArea_message" rows="1" oninput="autoResize()"></textarea>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <script>
            var url = window.location.href;
            var userID = getParameterByName('ClientID');
            console.log(userID);

            // get query string. Code from http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
            function getParameterByName(name, url) {
                if (!url) {
                    url = window.location.href;
                }
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                        results = regex.exec(url);
                if (!results)
                    return null;
                if (!results[2])
                    return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            function sendMessage() {
                var textarea = document.getElementById("textArea_message");
                var message = document.createElement("div");
                var paragraph = document.createElement("p");
                var text = document.createTextNode(textarea.value);

                paragraph.appendChild(text);
                message.className = "message";
                message.appendChild(paragraph);
                document.getElementById("messages").appendChild(message);

                var chatBox = document.getElementById("messages");
                chatBox.scrollTop = chatBox.scrollHeight;

                var textarea = document.getElementById("textArea_message");
                textarea.value = '';
                textarea.rows = 1;
            }

            function sendMessage2(actualText) {
                var message = document.createElement("div");
                var paragraph = document.createElement("p");
                var text = document.createTextNode(actualText);

                paragraph.appendChild(text);
                message.className = "message";
                message.appendChild(paragraph);
                document.getElementById("messages").appendChild(message);

                var chatBox = document.getElementById("messages");
                chatBox.scrollTop = chatBox.scrollHeight;
            }

            var rows = 1;
            function autoResize() {
                var textarea = document.getElementById("textArea_message");
                if (textarea.clientHeight < textarea.scrollHeight) {
                    textarea.rows++;
                }
            }

            var aChat = [
                "Holy Shit!",
                "What is this!?",
                "Forged in God's very flames!",
                "Do my eyes, tell me lies?",
                "A new JavaScript chat!"
            ];

            var element;
            var time = 800;
            var i = 0;

            (function loop() {
                sendMessage2(aChat[i]);
                if (++i < aChat.length) {
                    setTimeout(loop, time);
                }
                time += 300;
            })();
        </script>
    </body>
</html>
